{% assign section_id = section.id | replace: "_", "" | replace: "-", "" %}
{% render "section-styles", section_id: section_id, section: section %}

{%- render 'vite' with '@sectionStyles/_related-articles.scss' -%}

<div class="section-related-article__container">
    <div class="wrap wrap--x-large wrap--{{ section_id }}">
        <div class="section-related-articles__inner">
            {% if section.settings.title != blank %}
                <div class="section-related-articles__header">
                    <h3 class="medium">{{ section.settings.title }}</h3>
                    <a class="button-text button-text--primary" aria-label="{{ 'blogs.blog.discover_more' | t }}" href="{{ section.settings.blog.url }}"><span>{{ 'blogs.blog.discover_more' | t }}</span></a>
                </div>
            {% endif %}
            <div class="section-related-articles__articles">
                {% if section.blocks.size == 4 %}
                    {% for block in section.blocks %}
                        {% if block.settings.article != blank %}
                            {% render 'card-article', article: block.settings.article %}
                        {% endif %}
                    {% endfor %}
                {% else %}
                    {% assign rendered_count = 0 %}
                    {% for blogArticle in blog.articles %}
                        {% if blogArticle.id != article.id %}
                            {% render 'card-article', article: blogArticle %} 
                            {% assign rendered_count = rendered_count | plus: 1 %}
                        {% endif %}
                        {% if rendered_count == 4 %}
                            {% break %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% schema %}
{
    "name": "Related Articles",
    "tag": "section",
    "class": "section-related-articles",
    "blocks": [
        {
            "name": "Article",
            "type": "article",
            "limit": 4,
            "settings": [
                {
                    "type": "article",
                    "id": "article",
                    "label": "Article",
                    "info": "To override default articles pulled in"
                }
            ]
        }
    ],
    "settings": [
        {
            "type": "text",
            "id": "title",
            "label": "Title",
            "default": "Related Blogs"
        },
        {
            "type": "color_background",
            "id": "image_overlay",
            "label": "Image Overlay"
        },
        {
            "type": "header",
            "content": "Desktop padding"
        },
        {
            "type": "range",
            "id": "padding_top",
            "min": 0,
            "max": 200,
            "step": 2,
            "unit": "px",
            "label": "Padding top",
            "default": 56
        },
        {
            "type": "range",
            "id": "padding_bottom",
            "min": 0,
            "max": 200,
            "step": 2,
            "unit": "px",
            "label": "Padding bottom",
            "default": 56
        },
        {
            "type": "header",
            "content": "Mobile padding"
        },
        {
            "type": "range",
            "id": "mobile_padding_top",
            "min": 0,
            "max": 200,
            "step": 2,
            "unit": "px",
            "label": "Padding top",
            "default": 56
        },
        {
            "type": "range",
            "id": "mobile_padding_bottom",
            "min": 0,
            "max": 200,
            "step": 2,
            "unit": "px",
            "label": "Padding bottom",
            "default": 56
        }
    ],
    "presets": [
        {
            "name": "Related Articles"
        }
    ]
}
{% endschema %}